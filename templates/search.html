<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Search Stock - SMARTEST</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">

</head>

<body class="bg-dark text-light">

  <!-- üîô Unified Minimal Navbar -->
<nav class="navbar navbar-dark bg-black px-4 py-2" style="height: 64px;">
  <div class="container-fluid d-flex justify-content-between align-items-center">

    <!-- Left: Back Button -->
    <a href="/" class="btn btn-back-dark">‚¨Ö Back to Home</a>

    <!-- Center: Logo + Title -->
    <a class="navbar-brand d-flex justify-content-center align-items-center mx-auto gap-2" href="/"
       style="font-size: 1.6rem; font-weight: bold; color: white;">
      <img src="{{ url_for('static', filename='favicon.png') }}" alt="Logo" height="40"
           style="margin-bottom: 2px;">
      SMARTEST
    </a>

    <!-- Right: Empty div to balance space -->
    <div style="width: 130px;"></div>
  </div>
</nav>


  <div class="container py-5">
    {% if data %}
<div class="card bg-dark text-light border-info shadow-sm p-4">
      <!-- Inside the existing <div class="card-body"> -->
<div class="row g-4 mb-2">
        <!-- üìä Score Section - Left -->
        <div class="col-md-6 ps-10">
          <h3 class="card-title">
            {{ data['name'] }}
            {% if data['symbol'] %} ({{ data['symbol'] }}){% endif %}
          </h3>
          <p>{{ data['sector'] }} ‚Ä¢ Market Cap: ‚Çπ{{ data['market_cap'] | inr_crore }} Cr</p>

          <h5>SMARTEST Score:
            {% if score >= 8 %}
            <span class="badge bg-success">{{ score }}/10</span>
            {% else %}
            {{ score }}/10
            {% endif %}
          </h5>

          <ul class="mt-3">
            {% for item in breakdown %}
            <li>{{ item }}</li>
            {% endfor %}
          </ul>

          <!-- ‚≠ê Add to Watchlist -->
          <form action="/add_watchlist" method="POST" class="mt-4">
            <input type="hidden" name="ticker" value="{{ data['symbol'] }}">
            <input type="hidden" name="name" value="{{ data['name'] }}">
            <button type="submit" class="btn btn-outline-warning">‚≠ê Add to Watchlist</button>
          </form>
        </div>

        <!-- üìà Chart + üì∞ News - Right -->
        <div class="col-md-6">
          <h5 class="mb-3">üìà 1-Year Stock Price Chart</h5>
          <canvas id="priceChart" style="background-color: #1e1e1e; border-radius: 8px; height: 280px;"></canvas>

          <h5 class="mt-4">üì∞ Recent News</h5>
          {% if news %}
          <ul class="list-group list-group-flush">
            {% for article in news %}
            <li class="list-group-item bg-dark">
              <a href="{{ article.url }}" class="text-info" target="_blank">{{ article.title }}</a><br>
              <small class="text-muted">{{ article.date }} | Sentiment: {{ article.sentiment }}</small>
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <p class="text-muted">No recent news found for this stock.</p>
          {% endif %}
        </div>
      </div>


      <!-- üìâ Chart Script -->
      <script>
        const dates = {{ chart_labels | safe }};
        const prices = {{ chart_data | safe }};


        const ctx = document.getElementById('priceChart').getContext('2d');
        new Chart(ctx, {
          type: 'line',
          data: {
            labels: dates,
            datasets: [{
              label: 'Closing Price (‚Çπ)',
              data: prices,
              borderColor: '#00bcd4',
              backgroundColor: 'rgba(0,188,212,0.1)',
              fill: true,
              tension: 0.1,
              pointRadius: 0
            }]
          },
          options: {
            scales: {
              x: { display: false },
              y: {
                ticks: { color: '#ccc' },
                grid: { color: '#444' }
              }
            },
            plugins: {
              legend: { labels: { color: '#ccc' } },
              tooltip: {
                callbacks: {
                  label: (context) => `‚Çπ${context.formattedValue}`
                }
              }
            }
          }
        });
      </script>

    </div>

  </div>
  {% else %}
  <p class="text-muted text-center mt-5">No stock data found. Try searching again.</p>
  {% endif %}
  </div>

</body>

</html>